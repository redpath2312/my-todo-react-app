<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1400" height="900" viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill:#ffffff; stroke:#1f2937; stroke-width:2; rx:10; ry:10; }
      .title { font: 700 16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; fill:#111827; }
      .small { font: 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; fill:#374151; }
      .arrow { stroke:#374151; stroke-width:2; marker-end:url(#arrowhead); fill:none; }
      .section { font: 700 18px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; fill:#2563eb; }
      .label { font: 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; fill:#2563eb; }
      .chip { fill:#eef2ff; stroke:#6366f1; stroke-width:1.5; rx:8; ry:8; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>

  <!-- Sections -->
  <text x="60" y="40" class="section">Providers</text>
  <text x="720" y="40" class="section">Routes / Pages</text>

  <!-- Providers stack -->
  <rect x="40" y="70" width="520" height="730" class="box" fill="#f9fafb" stroke="#e5e7eb"/>
  <rect x="70" y="100" width="460" height="90" class="box"/>
  <text x="90" y="130" class="title">UIProvider (UIContext)</text>
  <text x="90" y="155" class="small">• editingLockRef / editingLocked / lockEditing / unlockEditing</text>
  <text x="90" y="175" class="small">• transitionState • withTransition(label, fn)</text>

  <rect x="70" y="210" width="460" height="90" class="box"/>
  <text x="90" y="240" class="title">ErrorProvider</text>
  <text x="90" y="265" class="small">Global error boundary / toasts</text>

  <rect x="70" y="320" width="460" height="90" class="box"/>
  <text x="90" y="350" class="title">Router</text>
  <text x="90" y="375" class="small">react-router-dom</text>

  <rect x="70" y="430" width="460" height="140" class="box"/>
  <text x="90" y="460" class="title">AuthProvider (AuthContext)</text>
  <text x="90" y="485" class="small">• user, userState: checking | loggedIn | loggedOut | guest</text>
  <text x="90" y="505" class="small">• login/logout/handleGuestSignIn</text>
  <text x="90" y="525" class="small">• (optional) isLogoutTransitioning (legacy)</text>

  <rect x="70" y="590" width="460" height="190" class="box"/>
  <text x="90" y="620" class="title">Main / App (Suspense)</text>
  <text x="90" y="645" class="small">Suspense fallback → &lt;AuthPageGate state="loading-app" /&gt;</text>
  <text x="90" y="665" class="small">Renders AppRouter with all routes</text>

  <!-- firebase client -->
  <rect x="90" y="800" width="240" height="60" class="box"/>
  <text x="110" y="830" class="title">firebaseAuthClient</text>
  <text x="110" y="850" class="small">Lazy-initialised Firebase Auth</text>

  <!-- Routes area -->
  <rect x="680" y="70" width="680" height="730" class="box" fill="#f9fafb" stroke="#e5e7eb"/>
  <rect x="710" y="100" width="280" height="80" class="box"/>
  <text x="730" y="130" class="title">HomeRedirect</text>
  <text x="730" y="155" class="small">→ /dashboard | /guest | /login</text>

  <rect x="1010" y="100" width="320" height="80" class="box"/>
  <text x="1030" y="130" class="title">AuthCallback (OAuth)</text>
  <text x="1030" y="155" class="small">Shows "Signing you in…" during redirect finish</text>

  <rect x="710" y="200" width="280" height="80" class="box"/>
  <text x="730" y="230" class="title">AuthPagesGuard</text>
  <text x="730" y="255" class="small">Wraps Login / Register / ForgotPwd</text>

  <rect x="1010" y="200" width="320" height="80" class="box"/>
  <text x="1030" y="230" class="title">AuthPageGate</text>
  <text x="1030" y="255" class="small">Full-page holds (loading, signing in/out, guest)</text>

  <rect x="710" y="300" width="160" height="70" class="box"/>
  <text x="730" y="330" class="title">/login</text>

  <rect x="880" y="300" width="160" height="70" class="box"/>
  <text x="900" y="330" class="title">/register</text>

  <rect x="1050" y="300" width="160" height="70" class="box"/>
  <text x="1065" y="330" class="title">/forgotpwd</text>

  <rect x="1220" y="300" width="140" height="70" class="box"/>
  <text x="1240" y="330" class="title">/dashboard</text>

  <rect x="710" y="390" width="180" height="70" class="box"/>
  <text x="730" y="420" class="title">/guest</text>

  <!-- GuestGate -->
  <rect x="910" y="390" width="180" height="70" class="box"/>
  <text x="930" y="420" class="title">GuestGate</text>

  <!-- Arrows -->
  <line x1="300" y1="560" x2="210" y2="800" class="arrow" />
  <text x="315" y="690" class="label">uses</text>

  <line x1="300" y1="160" x2="920" y2="240" class="arrow" />
  <text x="620" y="165" class="label">transitionState</text>

  <line x1="300" y1="160" x2="1090" y2="240" class="arrow" />
  <text x="980" y="175" class="label">fallback if no state prop</text>

  <line x1="300" y1="500" x2="740" y2="135" class="arrow" />
  <text x="520" y="440" class="label">reads user/userState</text>

  <line x1="300" y1="500" x2="1160" y2="135" class="arrow" />
  <text x="980" y="470" class="label">reads user/userState</text>

  <line x1="300" y1="680" x2="970" y2="240" class="arrow" />
  <text x="760" y="600" class="label">Suspense fallback → AuthPageGate</text>

  <line x1="1090" y1="350" x2="1220" y2="350" class="arrow" />
  <text x="1135" y="335" class="label">on success</text>

  <line x1="800" y1="350" x2="750" y2="240" class="arrow" />
  <text x="730" y="285" class="label">wrapped by</text>

  <line x1="970" y1="425" x2="1120" y2="240" class="arrow" />
  <text x="1000" y="400" class="label">shows</text>

  <line x1="800" y1="425" x2="970" y2="425" class="arrow" />
  <text x="860" y="410" class="label">/guest flow</text>

  <!-- Chips: gate states -->
  <rect x="1010" y="520" width="320" height="220" class="box"/>
  <text x="1030" y="550" class="title">AuthPageGate states</text>
  <rect x="1030" y="570" width="260" height="28" class="chip"/>
  <text x="1045" y="589" class="small">loading-app</text>
  <rect x="1030" y="604" width="260" height="28" class="chip"/>
  <text x="1045" y="623" class="small">checking-auth</text>
  <rect x="1030" y="638" width="260" height="28" class="chip"/>
  <text x="1045" y="657" class="small">signing-in</text>
  <rect x="1030" y="672" width="260" height="28" class="chip"/>
  <text x="1045" y="691" class="small">signing-out</text>
  <rect x="1030" y="706" width="260" height="28" class="chip"/>
  <text x="1045" y="725" class="small">switching-to-guest</text>

</svg>
